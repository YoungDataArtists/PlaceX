
@{
    ViewBag.Title = "PlaceX-Test-Map";
}
<h2>Map</h2>
<div class="row">
    <div class="col-sm-9">

        <div id="map" style="height:400px;"></div>

    </div>
    <div class="col-sm-3">

        <p>User's markers</p>
        <input type="text" id="input-position" placeholder="Tap the map" style="width: 100%;">
        <div id="floating-panel">
            <input onclick="saveMarker();" type=button value="Save marker">

            @using (Html.BeginForm("GetCoordinatesFromUser", "Map", FormMethod.Post))
            {
                <input type="text" id="UpdateDiv" value="" name="stringOfCoordinates" style="width: 100%;"><br />
                <input type="submit" value="Upload to server" />
            }
        </div>

    </div>

</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyArQis35LbcmrOvvVlAJtsHABL7ObLubk8"></script>

<script type="text/javascript">

    var map;
    var marker = new google.maps.Marker();
    var coordinatesForServer = "";
    var markers = [];

    function initialize() {
        var centerPoint = new google.maps.LatLng(46.483232, 30.738147);

        var mapOptions = {
            center: centerPoint,
            zoom: 16
        };

        map = new google.maps.Map(document.getElementById('map'), mapOptions);
        map.data.loadGeoJson('/Map/GetGeoJson');

        map.addListener('click', function (e) {
            placeMarkerAndPanTo(e.latLng, map);
        });
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    function placeMarkerAndPanTo(latLng, map) {
        document.getElementById("input-position").value = latLng;
        marker.setMap(null);
        marker = new google.maps.Marker({
            position: latLng,
            map: map
        });
        showMarkers();
    }

    function saveMarker() {
        markers.push(marker);
        coordinatesForServer += document.getElementById("input-position").value;
        document.getElementById("UpdateDiv").value = coordinatesForServer;
    }

    function showMarkers() {
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(map);
        }
    }

</script>