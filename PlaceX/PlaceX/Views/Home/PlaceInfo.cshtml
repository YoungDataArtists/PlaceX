@model PlaceX.Models.PlaceViewModel

@{
    int rating_one = 0;
    int rating_two = 0;
    int rating_three = 0;
    int rating_four = 0;
    int rating_five = 0;
    foreach (var review in Model.Reviews)
    {
        switch (review.Rating)
        {
            case 1:
                rating_one += 1;
                break;
            case 2:
                rating_two += 1;
                break;
            case 3:
                rating_three += 1;
                break;
            case 4:
                rating_four += 1;
                break;
            case 5:
                rating_five += 1;
                break;
        }
    }

    decimal quantity_rating = rating_one + rating_two + rating_three + rating_four + rating_five;
    decimal average_rating;
    List<int> rating_list = new List<int>() { rating_one, rating_two, rating_three, rating_four, rating_five };
    int max_quantity_rating;

    if (quantity_rating == 0) {
        average_rating = 0;
        max_quantity_rating = 1;
    }
    else
    {
        average_rating = (rating_one * 1 + rating_two * 2 + rating_three * 3 + rating_four * 4 + rating_five * 5) / quantity_rating;
        max_quantity_rating = rating_list.Max();
    }
    string width_rating_one = (rating_one * 100 / max_quantity_rating).ToString() + "%";
    string width_rating_two = (rating_two * 100 / max_quantity_rating).ToString() + "%";
    string width_rating_three = (rating_three * 100 / max_quantity_rating).ToString() + "%";
    string width_rating_four = (rating_four * 100 / max_quantity_rating).ToString() + "%";
    string width_rating_five = (rating_five * 100 / max_quantity_rating).ToString() + "%";
}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="well" style="padding: 1em 1em 0 1em;">
                <div class="row">
                    <div class="headerPlace">
                        <img src="@Model.PhotosUrls[0]" class="img-thumbnail col-md-2 col-sm-5 col-xs-5" />
                        <div class="row col-md-10 col-sm-7 col-xs-7">
                            <h1 class="text-center">@Model.Name</h1>
                        </div>
                        <div class="row col-md-9 col-sm-12 col-xs-12">
                            <div class="bodyPlace">
                                <ul>
                                    <li>Id: @Model.Id</li>
                                    <li>Address: @Model.Address</li>
                                    <li>PhoneNumber: @Model.PhoneNumber</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sectionBar row">
                    <div class="sectionGroup col-md-2 col-sm-4 col-xs-4">
                        <a href="#">
                            <span>Gallery</span>
                            <span style="color:grey;">666</span>
                        </a>
                    </div>
                    <div class="venueScore col-md-4 col-md-offset-6 col-sm-8 col-xs-8">
                        <span>Google Rating:<span class="positive">@Model.GoogleRating/5</span></span>
                        <span>"count of ratings"</span>
                        <span class="glyphicon glyphicon-heart"></span>
                    </div>
                </div>
                <!-- slider -->
                <div id="owl-demo">
                    @for (int i = 1; i < Model.PhotosUrls.Length; i++)
                    {
                        <div class="item">
                            <img src="@Model.PhotosUrls[i]" />
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Review -->
    <br>
    <div class="row">
        <div class="col-md-12">
            <div class="well">
                <h2 class="text-center">Reviews</h2>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="rating-block">
                <h4>Average user rating</h4>
                
                <h2 class="bold padding-bottom-7">
                    @if (average_rating == 0)
        {
                        <small>К сожалению, нет рейтинга</small>
                    }
                    else
                    {
                        @average_rating.ToString("#.##") <small> / 5 </small>
                    }
                </h2>


                @for (int i = 0; i < Decimal.Round(average_rating); i++)
                {
                    <button type="button" class="btn btn-warning btn-xs" aria-label="Left Align">
                        <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                    </button>
                }

                @for (int i = 0; i < 5 - Decimal.Round(average_rating); i++)
                {
                    <button type="button" class="btn btn-default btn-grey btn-xs" aria-label="Left Align">
                        <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                    </button>
                }
            </div>
        </div>
        <div class="col-sm-4">
            <h4>Rating breakdown</h4>
            <div class="pull-left">
                <div class="pull-left" style="width:35px; line-height:1;">
                    <div style="height:9px; margin:5px 0;">5 <span class="glyphicon glyphicon-star"></span></div>
                </div>
                <div class="pull-left" style="width:180px;">
                    <div class="progress" style="height:9px; margin:8px 0;">
                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="5" style="width: @width_rating_five">
                            <span class="sr-only">80% Complete (danger)</span>
                        </div>
                    </div>
                </div>
                <div class="pull-right" style="margin-left:10px;">@rating_five</div>
            </div>
            <div class="pull-left">
                <div class="pull-left" style="width:35px; line-height:1;">
                    <div style="height:9px; margin:5px 0;">4 <span class="glyphicon glyphicon-star"></span></div>
                </div>
                <div class="pull-left" style="width:180px;">
                    <div class="progress" style="height:9px; margin:8px 0;">
                        <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="4" aria-valuemin="0" aria-valuemax="5" style="width: @width_rating_four">
                            <span class="sr-only">80% Complete (danger)</span>
                        </div>
                    </div>
                </div>
                <div class="pull-right" style="margin-left:10px;">@rating_four</div>
            </div>
            <div class="pull-left">
                <div class="pull-left" style="width:35px; line-height:1;">
                    <div style="height:9px; margin:5px 0;">3 <span class="glyphicon glyphicon-star"></span></div>
                </div>
                <div class="pull-left" style="width:180px;">
                    <div class="progress" style="height:9px; margin:8px 0;">
                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="3" aria-valuemin="0" aria-valuemax="5" style="width: @width_rating_three">
                            <span class="sr-only">80% Complete (danger)</span>
                        </div>
                    </div>
                </div>
                <div class="pull-right" style="margin-left:10px;">@rating_three</div>
            </div>
            <div class="pull-left">
                <div class="pull-left" style="width:35px; line-height:1;">
                    <div style="height:9px; margin:5px 0;">2 <span class="glyphicon glyphicon-star"></span></div>
                </div>
                <div class="pull-left" style="width:180px;">
                    <div class="progress" style="height:9px; margin:8px 0;">
                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="5" style="width: @width_rating_two">
                            <span class="sr-only">80% Complete (danger)</span>
                        </div>
                    </div>
                </div>
                <div class="pull-right" style="margin-left:10px;">@rating_two</div>
            </div>
            <div class="pull-left">
                <div class="pull-left" style="width:35px; line-height:1;">
                    <div style="height:9px; margin:5px 0;">1 <span class="glyphicon glyphicon-star"></span></div>
                </div>
                <div class="pull-left" style="width:180px;">
                    <div class="progress" style="height:9px; margin:8px 0;">
                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="1" aria-valuemin="0" aria-valuemax="5" style="width: @width_rating_one">
                            <span class="sr-only">80% Complete (danger)</span>
                        </div>
                    </div>
                </div>
                <div class="pull-right" style="margin-left:10px;">@rating_one</div>
            </div>
        </div>
    </div>
    <hr />
    <!--Comments-->
    @if (!User.Identity.IsAuthenticated)
    {
        <p>Войдите в систему чтобы оставить отзыв.</p>
    }
    else
    {
        <div class="row ">
            <div class="col-lg-12">
                @using (Ajax.BeginForm("AddReview", new AjaxOptions { UpdateTargetId = "newReview" }))
                {

                    <div class="input-group">
                        <input type="text" class="form-control" name="textContent" aria-label="..." placeholder="Оставить комментарий">
                        <div class="input-group-btn">
                            <button type="submit" class="btn btn-default " aria-haspopup="true" aria-expanded="false">Отправить </button>
                        </div><!-- /btn-group -->
                    </div><!-- /input-group -->
                    <div id="reviewStars-input">
                        <input id="star-4" type="radio" name="rating" value="5" />
                        <label title="gorgeous" for="star-4"></label>

                        <input id="star-3" type="radio" name="rating" value="4" />
                        <label title="good" for="star-3"></label>

                        <input id="star-2" type="radio" name="rating" value="3" />
                        <label title="regular" for="star-2"></label>

                        <input id="star-1" type="radio" name="rating" value="2" />
                        <label title="poor" for="star-1"></label>

                        <input id="star-0" type="radio" name="rating" value="1" />
                        <label title="bad" for="star-0"></label>
                    </div>
                    <input type="hidden" value="@User.Identity.Name" name="author" />
                    <input type="hidden" value="@Model.Id" name="googlePlaceId" />                     
                }
            </div><!-- /.col-lg-12 -->
        </div><!-- /.row -->
    }
    <div class="row">
        <div class="col-sm-12">
            <hr />
            <div id="newReview"></div>
            <hr />

            @if (Model.Reviews.Count() == 0)
            {
                <p>К сожалению, нет отзывов об этом месте. Станьте первым и оставьте за собой след! :)</p>
            }
            else
            {
                foreach (var review in Model.Reviews)
                {
                    TimeSpan deltaDate = DateTime.Now - review.Date;
                    string delta = (deltaDate.Days == 0) ? "Today" : deltaDate.Days.ToString() + " day(s) ago";

                    <div class="review-block">
                        <div class="row">
                            <div class="col-sm-3">
                                <img src="http://dummyimage.com/60x60/666/ffffff&text=No+Image" class="img-rounded">
                                <div class="review-block-name"><a href="#">@review.Author</a></div>
                                <div class="review-block-date">@review.Date.Date.ToShortDateString()<br /> @delta</div>
                            </div>
                            <div class="col-sm-9">
                                <div class="review-block-rate">

                                    @for (int i = 0; i < review.Rating; i++)
                                    {
                                        <button type="button" class="btn btn-warning btn-xs" aria-label="Left Align">
                                            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                                        </button>
                                    }

                                    @for (int i = 0; i < 5 - review.Rating; i++)
                                    {
                                        <button type="button" class="btn btn-default btn-grey btn-xs" aria-label="Left Align">
                                            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                                        </button>
                                    }
                                </div>
                                <div class="review-block-title">@review.TextContent</div>
                                <div class="review-block-description">@review.TextContent</div>
                            </div>
                        </div>
                        <hr />
                    </div>
                }
            }        
        </div>
    </div>
</div>

